<!-- ***** Header Start ***** -->
<header class="modern-header">
  <nav class="modern-nav">
    <div class="nav-container">
      <!-- Logo -->
      <a routerLink="/" class="nav-logo">
        <img src="/images/logo/jungle-in-english-removebg-preview.png" alt="Jungle in English" class="logo-img">
        <span class="logo-text">JUNGLE IN ENGLISH</span>
      </a>

      <!-- Desktop Navigation -->
      <div class="nav-menu" [class.active]="mobileMenuOpen">
        <ul class="nav-links">
          <li><a routerLink="/" class="nav-link">Home</a></li>
          <li><a routerLink="/clubs" class="nav-link">Clubs</a></li>
        </ul>

        <!-- Auth Buttons / User Menu -->
        <div class="nav-actions">
          @if (!(isAuthenticated$ | async)) {
            <a routerLink="/login" class="btn-login">Login</a>
            <a routerLink="/register" class="btn-register">Get Started</a>
          } @else {
            <div class="nav-user-section">
              <app-frontoffice-notification-dropdown />
              <app-frontoffice-user-dropdown />
            </div>
          }
        </div>
      </div>

      <!-- Mobile Menu Toggle -->
      <button class="mobile-toggle" (click)="toggleMobileMenu()" [class.active]="mobileMenuOpen">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
  </nav>
</header>
<!-- ***** Header End ***** -->

<!-- Loading State -->
@if (loading) {
  <div class="loading-container">
    <div class="loading-spinner">
      <div class="spinner"></div>
      <p>Loading pack details...</p>
    </div>
  </div>
}

<!-- Pack Details Content -->
@if (!loading && pack) {
  <div class="pack-details-container">
  <!-- Back Button -->
  <div class="back-section">
    <button (click)="goBack()" class="back-btn">
      <svg class="back-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
      </svg>
      Back to Home
    </button>
  </div>

  <!-- Pack Header -->
  <div class="pack-header-section" [style.background]="'linear-gradient(135deg, ' + getCategoryColor() + ' 0%, ' + getCategoryColor() + 'dd 100%)'">
    <div class="pack-header-content">
      <div class="pack-badges">
        <span class="category-badge">
          {{ getCategoryIcon() }} {{ pack.category }}
        </span>
        <span class="level-badge">{{ pack.level }}</span>
        @if (pack.status === 'ACTIVE') {
          <span class="status-badge">‚úì Active</span>
        }
      </div>
      
      <h1 class="pack-title">{{ pack.name }}</h1>
      
      @if (pack.description) {
        <p class="pack-description">{{ pack.description }}</p>
      }
      
      <!-- Tutor Info -->
      <div class="tutor-card">
        <div class="tutor-avatar">
          <svg class="avatar-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
          </svg>
        </div>
        <div class="tutor-info">
          <span class="tutor-label">Taught by</span>
          <span class="tutor-name">{{ pack.tutorName }}</span>
          @if (pack.tutorRating) {
            <div class="tutor-rating">
              <svg class="star-icon" viewBox="0 0 20 20" fill="currentColor">
                <path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path>
              </svg>
              <span>{{ pack.tutorRating }}/5</span>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Price Card -->
    <div class="price-card">
      <div class="price-header">
        <span class="price-label">Pack Price</span>
        <div class="price-amount">
          <span class="currency">$</span>
          <span class="amount">{{ pack.price }}</span>
        </div>
      </div>
      
      <div class="price-stats">
        <div class="stat-row">
          <span class="stat-icon">üìö</span>
          <span class="stat-text">{{ pack.coursesCount }} Courses</span>
        </div>
        <div class="stat-row">
          <span class="stat-icon">‚è±Ô∏è</span>
          <span class="stat-text">{{ pack.estimatedDuration }} Hours</span>
        </div>
        <div class="stat-row">
          <span class="stat-icon">üë•</span>
          <span class="stat-text">{{ pack.availableSlots }} Slots Available</span>
        </div>
      </div>

      <!-- Enrollment Progress -->
      <div class="enrollment-section">
        <div class="enrollment-info">
          <span class="enrollment-label">Enrollment</span>
          <span class="enrollment-percentage">{{ getEnrollmentPercentage() }}%</span>
        </div>
        <div class="progress-bar">
          <div 
            class="progress-fill"
            [style.width.%]="getEnrollmentPercentage()"
            [class.low]="getEnrollmentPercentage() < 50"
            [class.medium]="getEnrollmentPercentage() >= 50 && getEnrollmentPercentage() < 80"
            [class.high]="getEnrollmentPercentage() >= 80">
          </div>
        </div>
      </div>

      <button 
        class="enroll-btn" 
        (click)="enrollInPack()"
        [disabled]="enrolling || isEnrolled || (pack.availableSlots ?? 0) === 0">
        @if (enrolling) {
          <span>
            <svg class="animate-spin inline-block w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Enrolling...
          </span>
        } @else if (isEnrolled) {
          <span>‚úì Already Enrolled</span>
        } @else if ((pack.availableSlots ?? 0) === 0) {
          <span>Pack Full</span>
        } @else {
          <span>Enroll Now</span>
        }
      </button>
    </div>
  </div>

  <!-- Courses Section -->
  <div class="courses-section">
    <h2 class="section-title">
      <span class="title-icon">üìö</span>
      Courses Included in This Pack
    </h2>

    @if (courses.length === 0) {
      <div class="no-courses">
        <p>No courses available in this pack yet.</p>
      </div>
    }

    @if (courses.length > 0) {
      <div class="courses-grid">
        @for (course of courses; track course.id) {
          <div class="course-card">
        <div class="course-header">
          <div class="course-level">{{ course.level }}</div>
          <div class="course-status" [class.published]="course.status === 'PUBLISHED'">
            @if (course.status === 'PUBLISHED') {
              <span>‚úì Published</span>
            } @else {
              <span>‚è≥ Draft</span>
            }
          </div>
        </div>
        
        <h3 class="course-title">{{ course.title }}</h3>
        @if (course.description) {
          <p class="course-desc">{{ course.description }}</p>
        }
        
        <div class="course-stats">
          <div class="course-stat">
            <span class="stat-icon">üìñ</span>
            <span class="stat-value">{{ course.chapterCount || 0 }} Chapters</span>
          </div>
          <div class="course-stat">
            <span class="stat-icon">üéì</span>
            <span class="stat-value">{{ course.lessonCount || 0 }} Lessons</span>
          </div>
        </div>

        <div class="course-footer">
          <span class="course-duration">‚è±Ô∏è {{ course.duration || 0 }}h</span>
        </div>
      </div>
        }
      </div>
    }
  </div>

  <!-- Enrollment Dates -->
  @if (pack.enrollmentStartDate || pack.enrollmentEndDate) {
    <div class="info-section">
      <h2 class="section-title">
        <span class="title-icon">üìÖ</span>
        Enrollment Period
      </h2>
      <div class="dates-card">
        @if (pack.enrollmentStartDate) {
          <div class="date-item">
            <span class="date-label">Start Date:</span>
            <span class="date-value">{{ pack.enrollmentStartDate | date: 'MMM dd, yyyy' }}</span>
          </div>
        }
        @if (pack.enrollmentEndDate) {
          <div class="date-item">
            <span class="date-label">End Date:</span>
            <span class="date-value">{{ pack.enrollmentEndDate | date: 'MMM dd, yyyy' }}</span>
          </div>
        }
      </div>
    </div>
  }
  </div>
}

<!-- Error State -->
@if (!loading && !pack) {
  <div class="error-container">
    <div class="error-content">
      <svg class="error-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
      </svg>
      <h2>Pack Not Found</h2>
      <p>The pack you're looking for doesn't exist or has been removed.</p>
      <button (click)="goBack()" class="back-home-btn">Back to Home</button>
    </div>
  </div>
}


<!-- Enrollment Confirmation Modal -->
@if (showEnrollModal) {
  <div class="modal-overlay" (click)="cancelEnrollment()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">Confirm Enrollment</h3>
        <button class="modal-close" (click)="cancelEnrollment()">
          <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>

      <div class="modal-body">
        <div class="enrollment-info-card">
          <div class="info-icon">üéì</div>
          <h4 class="pack-name-modal">{{ pack?.name }}</h4>
          <div class="pack-details-modal">
            <div class="detail-item">
              <span class="detail-label">Category:</span>
              <span class="detail-value">{{ pack?.category }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Level:</span>
              <span class="detail-value">{{ pack?.level }}</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Courses:</span>
              <span class="detail-value">{{ pack?.coursesCount }} courses</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Duration:</span>
              <span class="detail-value">{{ pack?.estimatedDuration }} hours</span>
            </div>
            <div class="detail-item">
              <span class="detail-label">Tutor:</span>
              <span class="detail-value">{{ pack?.tutorName }}</span>
            </div>
            <div class="detail-item price-item">
              <span class="detail-label">Price:</span>
              <span class="detail-value price-value">${{ pack?.price }}</span>
            </div>
          </div>
        </div>

        <div class="confirmation-message">
          <p>Are you sure you want to enroll in this pack?</p>
          <p class="confirmation-note">You will have access to all courses in this pack.</p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-cancel" (click)="cancelEnrollment()" [disabled]="enrolling">
          Cancel
        </button>
        <button class="btn-confirm" (click)="confirmEnrollment()" [disabled]="enrolling">
          @if (enrolling) {
            <svg class="animate-spin inline-block w-5 h-5 mr-2" fill="none" viewBox="0 0 24 24">
              <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
              <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
            </svg>
            Enrolling...
          } @else {
            Confirm Enrollment
          }
        </button>
      </div>
    </div>
  </div>
}
