<div class="min-h-screen bg-gray-50 p-6">
  <div class="w-full">
    <!-- Header -->
    <div class="mb-6">
      <button (click)="cancel()" 
              class="flex items-center text-gray-600 hover:text-[#F59E0B] transition-colors mb-4">
        <i class="fas fa-arrow-left mr-2"></i>
        Back to Complaints
      </button>
      <h1 class="text-3xl font-bold text-gray-900 flex items-center gap-3">
        <div class="w-12 h-12 rounded-xl bg-gradient-to-br from-[#F59E0B] to-[#e5ac4f] flex items-center justify-center">
          <i class="fas fa-edit text-white text-xl"></i>
        </div>
        Edit Complaint
      </h1>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="bg-white rounded-xl shadow-sm p-12 text-center">
      <i class="fas fa-spinner fa-spin text-4xl text-[#F59E0B] mb-4"></i>
      <p class="text-gray-600">Loading complaint...</p>
    </div>

    <!-- Edit Form -->
    <div *ngIf="!isLoading && complaint" class="space-y-6">
      <!-- Complaint Info Card -->
      <div class="bg-white rounded-xl shadow-sm p-6">
        <h2 class="text-xl font-bold text-gray-900 mb-4">Complaint Information</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <p class="text-sm text-gray-600 mb-1">Category</p>
            <p class="font-semibold text-gray-900">{{ complaint.category }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-600 mb-1">Priority</p>
            <span class="px-3 py-1 rounded-full text-xs font-semibold" [ngClass]="getPriorityClass(complaint.priority)">
              {{ complaint.priority }}
            </span>
          </div>
          <div>
            <p class="text-sm text-gray-600 mb-1">Target</p>
            <p class="font-semibold text-gray-900">{{ complaint.targetRole }}</p>
          </div>
          <div>
            <p class="text-sm text-gray-600 mb-1">Created</p>
            <p class="font-semibold text-gray-900">{{ formatDate(complaint.createdAt) }}</p>
          </div>
        </div>
      </div>

      <!-- Edit Form Card -->
      <div class="bg-white rounded-xl shadow-sm p-6">
        <h2 class="text-xl font-bold text-gray-900 mb-6">Edit Details</h2>
        
        <form (ngSubmit)="updateComplaint()" class="space-y-6">
          <!-- Subject -->
          <div>
            <label for="subject" class="block text-sm font-semibold text-gray-700 mb-2">
              Subject <span class="text-red-500">*</span>
            </label>
            <input 
              id="subject"
              type="text" 
              [(ngModel)]="editForm.subject"
              name="subject"
              required
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-[#F59E0B]"
              placeholder="Brief summary of your problem">
          </div>

          <!-- Description -->
          <div>
            <label for="description" class="block text-sm font-semibold text-gray-700 mb-2">
              Description <span class="text-red-500">*</span>
            </label>
            <textarea 
              id="description"
              [(ngModel)]="editForm.description"
              name="description"
              rows="6"
              required
              class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:border-[#F59E0B]"
              placeholder="Explain your problem in detail..."></textarea>
          </div>

          <!-- Current Status (Read-only for students) -->
          <div>
            <label class="block text-sm font-semibold text-gray-700 mb-2">
              Current Status
            </label>
            <div class="p-3 bg-gray-50 border border-gray-200 rounded-lg">
              <span class="px-3 py-1 rounded-full text-xs font-semibold" [ngClass]="getStatusClass(complaint.status)">
                {{ complaint.status }}
              </span>
            </div>
            <p class="text-xs text-gray-500 mt-1">
              <i class="fas fa-info-circle mr-1"></i>
              Only managers can update the status
            </p>
          </div>

          <!-- Messages/Responses -->
          <div *ngIf="messages.length > 0">
            <label class="block text-sm font-semibold text-gray-700 mb-3">
              <i class="fas fa-comments mr-2"></i>Conversation
            </label>
            <div class="space-y-3 max-h-96 overflow-y-auto">
              <div *ngFor="let message of messages" 
                   class="p-4 rounded-lg border-l-4"
                   [ngClass]="message.authorRole === 'STUDENT' ? 'bg-blue-50 border-blue-500' : 'bg-green-50 border-green-500'">
                <div class="flex justify-between items-start mb-2">
                  <span class="text-xs font-semibold"
                        [ngClass]="message.authorRole === 'STUDENT' ? 'text-blue-700' : 'text-green-700'">
                    {{ message.authorRole === 'STUDENT' ? 'You' : 'Response from ' + message.author }}
                  </span>
                  <span class="text-xs text-gray-500">
                    {{ formatDate(message.timestamp) }}
                  </span>
                </div>
                <p class="text-sm" 
                   [ngClass]="message.authorRole === 'STUDENT' ? 'text-blue-900' : 'text-green-900'">
                  {{ message.content }}
                </p>
              </div>
            </div>
          </div>

          <!-- No messages yet -->
          <div *ngIf="messages.length === 0" class="p-4 bg-gray-50 border border-gray-200 rounded-lg text-center">
            <i class="fas fa-inbox text-gray-400 text-3xl mb-2"></i>
            <p class="text-sm text-gray-600">No responses yet. Wait for a response from the team.</p>
          </div>

          <!-- Action Buttons -->
          <div class="flex justify-between pt-4">
            <button 
              type="button"
              (click)="cancel()" 
              class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition-colors font-semibold">
              <i class="fas fa-times mr-2"></i> Cancel
            </button>
            <button 
              type="submit"
              [disabled]="isSubmitting"
              class="px-6 py-3 bg-gradient-to-r from-[#F59E0B] to-[#e5ac4f] text-white rounded-lg hover:shadow-lg transition-all font-semibold disabled:opacity-50">
              <i class="fas fa-save mr-2"></i> {{ isSubmitting ? 'Saving...' : 'Save Changes' }}
            </button>
          </div>
        </form>
      </div>

      <!-- Additional Info -->
      <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg">
        <div class="flex items-start">
          <i class="fas fa-info-circle text-blue-600 mt-1 mr-3"></i>
          <div>
            <p class="text-sm text-blue-900 font-semibold mb-1">Student Editing Restrictions:</p>
            <ul class="text-sm text-blue-800 list-disc list-inside space-y-1">
              <li>You can only edit the subject and description</li>
              <li>Category, priority, and target cannot be changed</li>
              <li>Status can only be updated by managers</li>
              <li>Responses are added by tutors or managers</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
